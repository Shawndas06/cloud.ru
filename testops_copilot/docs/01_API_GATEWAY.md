# API Gateway - –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è Junior —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ß—Ç–æ —Ç–∞–∫–æ–µ API Gateway?](#—á—Ç–æ-—Ç–∞–∫–æ–µ-api-gateway)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∏-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
3. [–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
4. [–†–æ—É—Ç–µ—Ä—ã –∏ endpoints](#—Ä–æ—É—Ç–µ—Ä—ã-–∏-endpoints)
5. [Middleware –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤](#middleware-–∏-–æ–±—Ä–∞–±–æ—Ç–∫–∞-–∑–∞–ø—Ä–æ—Å–æ–≤)
6. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-–¥—Ä—É–≥–∏–º–∏-—Å–µ—Ä–≤–∏—Å–∞–º–∏)
7. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
8. [–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è](#–ø–æ–ª–µ–∑–Ω—ã–µ-—Å—Å—ã–ª–∫–∏-–¥–ª—è-–∏–∑—É—á–µ–Ω–∏—è)

---

## –ß—Ç–æ —Ç–∞–∫–æ–µ API Gateway?

**API Gateway** (—à–ª—é–∑ API) - —ç—Ç–æ –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å–æ–≤ (–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤, –≤–∞–ª–∏–¥–∞—Ç–æ—Ä, –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä), –∏ –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∫–ª–∏–µ–Ω—Ç –æ–±—Ä–∞—â–∞–ª—Å—è –∫ –∫–∞–∂–¥–æ–º—É –æ—Ç–¥–µ–ª—å–Ω–æ, –æ–Ω –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –æ–¥–Ω–æ–º—É —à–ª—é–∑—É, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω—É–∂–Ω–æ–º—É —Å–µ—Ä–≤–∏—Å—É.

### –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

1. **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞** - –∫–ª–∏–µ–Ω—Ç –Ω–µ –∑–Ω–∞–µ—Ç –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Å–∏—Å—Ç–µ–º—ã
2. **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è** - –∑–∞–ø—Ä–æ—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∫ –Ω—É–∂–Ω–æ–º—É —Å–µ—Ä–≤–∏—Å—É
3. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ
5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
api_gateway/
‚îú‚îÄ‚îÄ main.py                 # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ middleware/             # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û
‚îÇ   ‚îî‚îÄ‚îÄ logging_middleware.py
‚îî‚îÄ‚îÄ routers/                # –†–æ—É—Ç–µ—Ä—ã (–º–∞—Ä—à—Ä—É—Ç—ã)
    ‚îú‚îÄ‚îÄ generate.py         # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
    ‚îú‚îÄ‚îÄ validate.py         # –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
    ‚îú‚îÄ‚îÄ optimize.py         # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
    ‚îú‚îÄ‚îÄ test_plan.py        # –¢–µ—Å—Ç-–ø–ª–∞–Ω—ã
    ‚îú‚îÄ‚îÄ integrations.py     # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (Jira, Allure)
    ‚îú‚îÄ‚îÄ health.py           # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
    ‚îî‚îÄ‚îÄ ...
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç FastAPI

FastAPI - —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Python, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö.

**–ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä:**

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/hello")
def hello():
    return {"message": "–ü—Ä–∏–≤–µ—Ç!"}
```

–ö–æ–≥–¥–∞ –≤—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ `/docs`, FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é!

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (main.py)

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI(
    title="TestOps Copilot API",
    version="1.0.0",
    description="AI-powered test generation platform"
)
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –°–æ–∑–¥–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç `FastAPI` - —ç—Ç–æ –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `title`, `version`, `description` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–Ω—ã –≤ `/docs`

### 2. CORS Middleware

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # –†–∞–∑—Ä–µ—à–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã —Å –ª—é–±—ã—Ö –¥–æ–º–µ–Ω–æ–≤
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

**CORS** (Cross-Origin Resource Sharing) - –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—Ä–∞—É–∑–µ—Ä—É –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å –æ–¥–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞ –Ω–∞ –¥—Ä—É–≥–æ–π.

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑ CORS:**
- –í–∞—à frontend –Ω–∞ `localhost:3000`
- API –Ω–∞ `localhost:8000`
- –ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –ø–æ—Ä—Ç–∞–º–∏ (—ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

**–° CORS:**
- –ú—ã —è–≤–Ω–æ —Ä–∞–∑—Ä–µ—à–∞–µ–º —Ç–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã
- `allow_origins=["*"]` - —Ä–∞–∑—Ä–µ—à–∞–µ–º –≤—Å–µ–º (–≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –ª—É—á—à–µ —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã)

**–ü–æ–ª–µ–∑–Ω–∞—è —Å—Å—ã–ª–∫–∞:** [MDN: CORS](https://developer.mozilla.org/ru/docs/Web/HTTP/CORS)

### 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤

```python
from api_gateway.routers import generate, validate, optimize

app.include_router(generate.router, prefix="/api/v1/generate", tags=["Generation"])
app.include_router(validate.router, prefix="/api/v1/validate", tags=["Validation"])
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- `include_router` - –ø–æ–¥–∫–ª—é—á–∞–µ—Ç —Ä–æ—É—Ç–µ—Ä –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
- `prefix` - –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–µ—Ñ–∏–∫—Å –∫–æ –≤—Å–µ–º –ø—É—Ç—è–º —Ä–æ—É—Ç–µ—Ä–∞
- `tags` - –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç endpoints –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–ü—Ä–∏–º–µ—Ä:**
- –†–æ—É—Ç–µ—Ä –∏–º–µ–µ—Ç –ø—É—Ç—å `/test-cases`
- –° –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `/api/v1/generate` –ø–æ–ª—É—á–∞–µ—Ç—Å—è `/api/v1/generate/test-cases`

---

## –†–æ—É—Ç–µ—Ä—ã –∏ endpoints

### –ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–æ—É—Ç–µ—Ä?

–†–æ—É—Ç–µ—Ä - —ç—Ç–æ –≥—Ä—É–ø–ø–∞ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö endpoints. –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –≤—Å–µ –ø–∏—Å–∞—Ç—å –≤ `main.py`, –º—ã —Ä–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏.

### –ü—Ä–∏–º–µ—Ä —Ä–æ—É—Ç–µ—Ä–∞ (generate.py)

```python
from fastapi import APIRouter, HTTPException
from pydantic import BaseModel

router = APIRouter()

class GenerateRequest(BaseModel):
    url: str
    requirements: list[str]
    test_type: str

@router.post("/test-cases")
async def generate_test_cases(request: GenerateRequest):
    # –õ–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    return {"request_id": "..."}
```

**–†–∞–∑–±–æ—Ä –ø–æ —á–∞—Å—Ç—è–º:**

1. **`APIRouter()`** - —Å–æ–∑–¥–∞–µ—Ç —Ä–æ—É—Ç–µ—Ä
2. **`BaseModel`** - –∫–ª–∞—Å—Å Pydantic –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–∏–ø—ã
   - –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ–≤–µ—Ä–Ω—ã–µ - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 422
3. **`@router.post("/test-cases")`** - –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç endpoint
   - `POST` - –º–µ—Ç–æ–¥ HTTP
   - `"/test-cases"` - –ø—É—Ç—å
4. **`async def`** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
   - –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

### –¢–∏–ø—ã HTTP –º–µ—Ç–æ–¥–æ–≤

- **GET** - –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏)
- **POST** - —Å–æ–∑–¥–∞—Ç—å/–æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é)
- **PUT** - –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
- **DELETE** - —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ

**–ü–æ–ª–µ–∑–Ω–∞—è —Å—Å—ã–ª–∫–∞:** [MDN: HTTP Methods](https://developer.mozilla.org/ru/docs/Web/HTTP/Methods)

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å Pydantic

```python
class GenerateRequest(BaseModel):
    url: str                    # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ, —Å—Ç—Ä–æ–∫–∞
    requirements: list[str]     # –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫
    test_type: str = "automated"  # –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ, –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç Pydantic:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ `url` - —Å—Ç—Ä–æ–∫–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ `requirements` - —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫
- –ï—Å–ª–∏ `test_type` –Ω–µ —É–∫–∞–∑–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç "automated"
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ–≤–µ—Ä–Ω—ã–µ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É

**–ü—Ä–∏–º–µ—Ä –æ—à–∏–±–∫–∏:**
```json
{
  "detail": [
    {
      "loc": ["body", "url"],
      "msg": "field required",
      "type": "value_error.missing"
    }
  ]
}
```

**–ü–æ–ª–µ–∑–Ω–∞—è —Å—Å—ã–ª–∫–∞:** [Pydantic Documentation](https://docs.pydantic.dev/)

---

## Middleware –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

### –ß—Ç–æ —Ç–∞–∫–æ–µ Middleware?

Middleware - —ç—Ç–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û, –∫–æ—Ç–æ—Ä–æ–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –î–û —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω–∏ –ø–æ–ø–∞–¥—É—Ç –≤ endpoint, –∏ –æ—Ç–≤–µ—Ç—ã –ü–û–°–õ–ï —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω–∏ –≤—ã–π–¥—É—Ç –∏–∑ endpoint.

**–°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã:**
```
–ö–ª–∏–µ–Ω—Ç ‚Üí Middleware ‚Üí Endpoint ‚Üí Middleware ‚Üí –ö–ª–∏–µ–Ω—Ç
```

### –ü—Ä–∏–º–µ—Ä: Logging Middleware

```python
@app.middleware("http")
async def logging_middleware(request: Request, call_next):
    start_time = time.time()
    
    # –õ–æ–≥–∏—Ä—É–µ–º –≤—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å
    logger.info(f"Incoming request: {request.method} {request.path}")
    
    # –ü–µ—Ä–µ–¥–∞–µ–º –∑–∞–ø—Ä–æ—Å –¥–∞–ª—å—à–µ
    response = await call_next(request)
    
    # –õ–æ–≥–∏—Ä—É–µ–º –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    process_time = time.time() - start_time
    logger.info(f"Request completed in {process_time:.2f}s")
    
    return response
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ó–∞–ø—Ä–æ—Å –ø—Ä–∏—Ö–æ–¥–∏—Ç
2. Middleware –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –µ–≥–æ
3. –õ–æ–≥–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
4. –í—ã–∑—ã–≤–∞–µ—Ç `call_next(request)` - –ø–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–ª—å—à–µ
5. –ü–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç
6. –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
7. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É

**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò–∑–º–µ—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

### 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Celery (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏)

```python
from workers.tasks.generate_workflow import generate_test_cases_task

@router.post("/test-cases")
async def generate_test_cases(request: GenerateRequest):
    # –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–¥–∞—á—É –≤ Celery
    task = generate_test_cases_task.delay(
        url=request.url,
        requirements=request.requirements
    )
    
    return {
        "request_id": task.id,
        "status": "processing"
    }
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- `generate_test_cases_task.delay()` - –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á—É –≤ —Ñ–æ–Ω–µ
- Celery Worker –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á—É
- –í–æ–∑–≤—Ä–∞—â–∞–µ–º `task.id` - –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å

**–ü–æ—á–µ–º—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ?**
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –º–∏–Ω—É—Ç—ã
- –ï—Å–ª–∏ –¥–µ–ª–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ - –∫–ª–∏–µ–Ω—Ç –∂–¥–µ—Ç
- –° Celery - –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç ID –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å

**–ü–æ–ª–µ–∑–Ω–∞—è —Å—Å—ã–ª–∫–∞:** [Celery Documentation](https://docs.celeryq.dev/)

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

```python
from shared.utils.database import get_db_dependency

@router.get("/tasks/{task_id}")
async def get_task_status(task_id: str, db: Session = Depends(get_db_dependency)):
    # –ü–æ–ª—É—á–∞–µ–º –∑–∞–¥–∞—á—É –∏–∑ –ë–î
    task = db.query(Task).filter(Task.id == task_id).first()
    
    if not task:
        raise HTTPException(status_code=404, detail="Task not found")
    
    return {"status": task.status, "result": task.result}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- `Depends(get_db_dependency)` - FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é –ë–î
- –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è endpoint —Å–µ—Å—Å–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è Dependency Injection (–≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)

**–ü–æ–ª–µ–∑–Ω–∞—è —Å—Å—ã–ª–∫–∞:** [FastAPI Dependencies](https://fastapi.tiangolo.com/tutorial/dependencies/)

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Redis

```python
from shared.utils.redis_client import redis_client

@router.get("/cache/{key}")
async def get_cache(key: str):
    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–µ—à–∞
    cached = redis_client.cache.get(key)
    
    if cached:
        return {"data": cached}
    
    return {"data": None}
```

**–ó–∞—á–µ–º Redis?**
- –ë—ã—Å—Ç—Ä–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –û—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á –¥–ª—è Celery

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### HTTP Exception

```python
from fastapi import HTTPException

@router.get("/tasks/{task_id}")
async def get_task(task_id: str):
    task = find_task(task_id)
    
    if not task:
        raise HTTPException(
            status_code=404,
            detail="Task not found"
        )
    
    return task
```

**HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥—ã:**
- **200** - OK (—É—Å–ø–µ—à–Ω–æ)
- **201** - Created (—Å–æ–∑–¥–∞–Ω–æ)
- **400** - Bad Request (–Ω–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å)
- **404** - Not Found (–Ω–µ –Ω–∞–π–¥–µ–Ω–æ)
- **500** - Internal Server Error (–æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞)

**–ü–æ–ª–µ–∑–Ω–∞—è —Å—Å—ã–ª–∫–∞:** [MDN: HTTP Status Codes](https://developer.mozilla.org/ru/docs/Web/HTTP/Status)

### Try-Except –±–ª–æ–∫–∏

```python
@router.post("/generate")
async def generate(request: GenerateRequest):
    try:
        result = await some_operation(request)
        return result
    except ValueError as e:
        raise HTTPException(status_code=400, detail=str(e))
    except Exception as e:
        logger.error(f"Unexpected error: {e}", exc_info=True)
        raise HTTPException(status_code=500, detail="Internal server error")
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- `try` - –ø—ã—Ç–∞–µ–º—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
- `except ValueError` - –ª–æ–≤–∏–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –æ—à–∏–±–∫—É
- `except Exception` - –ª–æ–≤–∏–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏
- `logger.error` - –ª–æ–≥–∏—Ä—É–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- `exc_info=True` - —Å–æ—Ö—Ä–∞–Ω—è–µ–º traceback

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è

### FastAPI
- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è FastAPI](https://fastapi.tiangolo.com/)
- [FastAPI Tutorial](https://fastapi.tiangolo.com/tutorial/)
- [FastAPI Best Practices](https://github.com/zhanymkanov/fastapi-best-practices)

### Python Async/Await
- [Real Python: Async IO](https://realpython.com/async-io-python/)
- [Python Async/Await Explained](https://www.youtube.com/watch?v=t5Bo1Je9EmE)

### Pydantic
- [Pydantic Documentation](https://docs.pydantic.dev/)
- [Pydantic Tutorial](https://docs.pydantic.dev/latest/tutorial/)

### HTTP –∏ REST API
- [MDN: HTTP](https://developer.mozilla.org/ru/docs/Web/HTTP)
- [REST API Tutorial](https://restfulapi.net/)
- [HTTP Status Codes](https://httpstatuses.com/)

### Docker –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- [Docker Documentation](https://docs.docker.com/)
- [Docker Compose](https://docs.docker.com/compose/)

---

## –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### Q: –ü–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è async/await?

**A:** Async –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏. –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –¥–ª—è I/O –æ–ø–µ—Ä–∞—Ü–∏–π (–∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î, API –∏ —Ç.–¥.).

**–ü—Ä–∏–º–µ—Ä:**
```python
# –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–º–µ–¥–ª–µ–Ω–Ω–æ)
def process():
    result1 = slow_operation_1()  # –ñ–¥–µ–º 1 —Å–µ–∫—É–Ω–¥—É
    result2 = slow_operation_2()   # –ñ–¥–µ–º 1 —Å–µ–∫—É–Ω–¥—É
    # –ò—Ç–æ–≥–æ: 2 —Å–µ–∫—É–Ω–¥—ã

# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–±—ã—Å—Ç—Ä–æ)
async def process():
    result1, result2 = await asyncio.gather(
        slow_operation_1(),  # –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
        slow_operation_2()  # –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
    )
    # –ò—Ç–æ–≥–æ: 1 —Å–µ–∫—É–Ω–¥–∞ (–º–∞–∫—Å–∏–º—É–º –∏–∑ –¥–≤—É—Ö)
```

### Q: –ß—Ç–æ —Ç–∞–∫–æ–µ Dependency Injection?

**A:** –≠—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω, –∫–æ–≥–¥–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–µ—Å—Å–∏—è –ë–î) –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∞ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏.

**–ë–µ–∑ DI:**
```python
def get_user(user_id):
    db = create_db_session()  # –°–æ–∑–¥–∞–µ–º –≤–Ω—É—Ç—Ä–∏
    return db.query(User).filter(User.id == user_id).first()
```

**–° DI:**
```python
def get_user(user_id, db: Session = Depends(get_db)):
    # db —É–∂–µ —Å–æ–∑–¥–∞–Ω –∏ –ø–µ—Ä–µ–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    return db.query(User).filter(User.id == user_id).first()
```

### Q: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è?

**A:** FastAPI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OpenAPI —Å—Ç–∞–Ω–¥–∞—Ä—Ç. –ö–æ–≥–¥–∞ –≤—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö (Pydantic –º–æ–¥–µ–ª–∏), FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ö–µ–º—É API –∏ —Å–æ–∑–¥–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –Ω–∞ `/docs`.

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

API Gateway - —ç—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ —Å–∏—Å—Ç–µ–º—ã, –∫–æ—Ç–æ—Ä–∞—è:
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∏—Ö –∫ –Ω—É–∂–Ω—ã–º —Å–µ—Ä–≤–∏—Å–∞–º
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ
- –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã API Gateway –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã!

